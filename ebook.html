<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="v0.2.0-upstream: identity configuration management for Kubernetes">
<title>identity configuration management for Kubernetes documentation (Technology Preview)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body id="idp-mgmt-docs" class="book toc2 toc-left">
<div id="header">
<h1>identity configuration management for Kubernetes documentation (Technology Preview)</h1>
<div class="details">
<span id="author" class="author">v0.2.0-upstream: identity configuration management for Kubernetes</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#requirements-and-recommendations">Requirements and recommendations</a></li>
<li><a href="#installing-while-connected-online">Installing while connected online</a></li>
<li><a href="#install-on-disconnected-networks">Install on disconnected networks</a></li>
<li><a href="#getting-started">Getting started</a></li>
<li><a href="#uninstalling">Uninstalling</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The identity configuration management for Kubernetes is a Technology Preview feature only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process. For more information about the support scope of Red Hat Technology Preview features, see <a href="https://access.redhat.com/support/offerings/techpreview/" class="bare">https://access.redhat.com/support/offerings/techpreview/</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The identity configuration management for Kubernetes is a software operator that enhances cluster fleet management. It enables you to quickly and easily propagate OAuth authentication configuration across your fleet of OpenShift Container Platform clusters regardless of cloud provider or data center.</p>
</div>
</div>
</div>
<h1 id="requirements-and-recommendations" class="sect0">Requirements and recommendations</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Before you install identity configuration management for Kubernetes technology preview, review the following system configuration requirements and settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#supported-operating-systems-and-platforms">Supported operating systems and platforms</a></p>
</li>
<li>
<p><a href="#sizing-recommendations">Sizing recommendations</a></p>
</li>
<li>
<p><a href="#security-requirements">Security requirements</a></p>
</li>
<li>
<p><a href="#network-configuration">Network configuration</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Note:</strong> There is no console for the Technology Preview version of this product.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="supported-operating-systems-and-platforms">Supported operating systems and platforms for hub clusters and managed clusters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The identity configuration management tech preview requires the <a href="https://stolostron.github.io/mce-docs/">multicluster engine for Kubernetes 1.0 Technology Preview</a> or <a href="https://www.redhat.com/en/technologies/management/advanced-cluster-management">Red Hat Advanced Cluster Management for Kubernetes 2.4</a>.</p>
</div>
<div class="paragraph">
<p>Both the hub and managed clusters must be running OpenShift Container Platform at the levels supported by your chosen multicluster solution, multicluster engine or Advanced Cluster Management. Red Hat OpenShift Managed cloud services are not supported for this technology preview.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Only OpenShift Container Platform 4.8 is supported for the hub, a minimum of 4.8.12 is required due to <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1969902">Bugzilla 1969902</a>. OpenShift Container Platform 4.9 is not currently supported.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sizing-recommendations">Sizing recommendations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are using multicluster engine, you will need a minimum of 1 node with 8 CPU, 32Gb of memory, and 100Gb disk.</p>
</div>
<div class="paragraph">
<p>If you are using Advanced Cluster Management, follow the RHACM sizing requirements.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-requirements">Security requirements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="openid-server-certificate">Securing OAuth requests to the OpenID Connect identity provider</h3>
<div class="paragraph">
<p>The identity configuration management operator instantiates one or more OpenID Connect identity providers under the covers to enable fleet-wide authentication. OAuth requests from the managed clusters to these identity providers must be secured using valid, signed certificates. This can be accomplished by <a href="https://docs.openshift.com/container-platform/4.8/security/certificates/replacing-default-ingress-certificate.html#replacing-default-ingress">replacing the default ingress certificate</a> on the hub cluster or by providing a certicate in an AuthRealm custom resource.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="network-configuration">Network configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configure your network settings to allow the connections in the following sections. These network configurations are in addition to those required by multicluster engine and Advanced Cluster Management.</p>
</div>
<div class="sect2">
<h3 id="network-configuration-hub">Hub cluster networking requirements</h3>
<div class="paragraph">
<p>For the hub cluster networking requirements, see the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Direction</th>
<th class="tableblock halign-left valign-top">Connection</th>
<th class="tableblock halign-left valign-top">Port (if specified)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outbound</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GitHub or GitHub Enterprise API. This is only required if you are using GitHub as an identity provider.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outbound</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP server (Example: OpenLDAP or Azure Active Directory managed domain). This is only required if you are using LDAP as an identity provider.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inbound</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The OpenID Connect issuer from the managed cluster.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="network-configuration-managed">Managed cluster networking requirements</h3>
<div class="paragraph">
<p>For the managed cluster networking requirements, see the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Direction</th>
<th class="tableblock halign-left valign-top">Connection</th>
<th class="tableblock halign-left valign-top">Port (if specified)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outbound</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenID Connect issuer running on the hub cluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<h1 id="installing-while-connected-online" class="sect0">Installing while connected online</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The identity configuration management for Kubernetes operator is installed with Operator Lifecycle Manager, which manages the installation, upgrade, and removal of the components that encompass identity configuration management for Kubernetes.</p>
</div>
<div class="paragraph">
<p><strong>Required access:</strong> Cluster administrator</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By default, the identity configuration management components are installed on worker nodes of your OpenShift Container Platform cluster without any additional configuration. You can install the identity configuration management operator onto worker nodes by using the OpenShift Container Platform OperatorHub web console interface, or by using the OpenShift Container Platform CLI.</p>
</li>
<li>
<p>If you have configured your OpenShift Container Platform cluster with infrastructure nodes, you can install the identity configuration management onto those infrastructure nodes.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Upgrades are not supported from identity configuration management for Kubernetes v0.1.0. If you have v0.1.0 installed, you will need to uninstall it before installing v0.2.0.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#connect-prerequisites">Prerequisites</a></p>
</li>
<li>
<p><a href="#confirm-ocp-installation">Confirm your OpenShift Container Platform installation</a></p>
</li>
<li>
<p><a href="#installing-from-the-operatorhub">Installing from the OperatorHub web console interface</a></p>
</li>
<li>
<p><a href="#installing-from-the-cli">Installing from the OpenShift Container Platform CLI</a></p>
</li>
<li>
<p><a href="#installing-on-infra-node">Installing the on infrastructure nodes</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connect-prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you install identity configuration management for Kubernetes, see the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your RedHat OpenShift Container Platform cluster must have access to the identity configuration management for Kubernetes operator in the OperatorHub catalog from the OpenShift Container Platform console.</p>
</li>
<li>
<p>You need access to the <a href="https://catalog.redhat.com/software/containers/search?p=1&amp;application_categories_list=Container%20Platform%20%2F%20Management">catalog.redhat.com</a>.</p>
</li>
<li>
<p>OpenShift Container Platform version 4.8.12, or later, due to <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1969902">Bugzilla 1969902</a>, must be deployed in your environment, and you must be logged into with the OpenShift Container Platform CLI. See the following install documentation for OpenShift Container Platform:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.8/html/installing/index">OpenShift Container Platform version 4.8</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>OpenShift Container Platform version 4.9 is not currently supported.</p>
</li>
<li>
<p>Your OpenShift Container Platform command line interface (CLI) must be configured to run <code>oc</code> commands. See <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.8/html/cli_tools/openshift-cli-oc#cli-getting-started">Getting started with the CLI</a> for information about installing and configuring the OpenShift Container Platform CLI.</p>
</li>
<li>
<p>Your OpenShift Container Platform permissions must allow you to create a namespace.</p>
</li>
<li>
<p>You must have an Internet connection to access the dependencies for the operator.</p>
</li>
<li>
<p>You must have either <a href="https://stolostron.github.io/mce-docs/">multicluster engine for Kubernetes 1.0 Technology Preview</a> or <a href="https://www.redhat.com/en/technologies/management/advanced-cluster-management">Red Hat Advanced Cluster Management for Kubernetes 2.4</a> installed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="confirm-ocp-installation">Confirm your OpenShift Container Platform installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You must have a supported OpenShift Container Platform version, including the registry and storage services, installed and working. For more information about installing OpenShift Container Platform, see the OpenShift Container Platform documentation.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that the identity configuration management for Kubernetes operator is not already installed on your OpenShift Container Platform cluster. The identity configuration management for Kubernetes operator allows only one single installation on each OpenShift Container Platform cluster. Continue with the following steps if there is no installation.</p>
</li>
<li>
<p>To ensure that the OpenShift Container Platform cluster is set up correctly, access the OpenShift Container Platform web console with the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">kubectl -n openshift-console get route</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the following example output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">openshift-console console console-openshift-console.apps.new-coral.purple-chesterfield.com
console   https   reencrypt/Redirect     None</code></pre>
</div>
</div>
</li>
<li>
<p>Open the URL in your browser and check the result. If the console URL displays <code>console-openshift-console.router.default.svc.cluster.local</code>, set the value for <code>openshift_master_default_subdomain</code> when you install OpenShift Container Platform. See the following example of a URL: <code><a href="https://console-openshift-console.apps.new-coral.purple-chesterfield.com" class="bare">https://console-openshift-console.apps.new-coral.purple-chesterfield.com</a></code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can proceed to install
identity configuration management for Kubernetes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-from-the-operatorhub">Installing from the OperatorHub web console interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Best practice:</strong> From the <em>Administrator</em> view in your OpenShift Container Platform navigation, install the OperatorHub web console interface that is provided with OpenShift Container Platform.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select <strong>Operators</strong> &gt; <strong>OperatorHub</strong> to access the list of available operators, and select <em>identity configuration management for Kubernetes</em> operator.</p>
</li>
<li>
<p>On the <em>Operator subscription</em> page, select the options for your installation:</p>
<div class="ulist">
<ul>
<li>
<p>Namespace:</p>
<div class="ulist">
<ul>
<li>
<p>The identity configuration management for Kubernetes must be installed in its own namespace, or project.</p>
</li>
<li>
<p>Under <strong>Installed Namespace</strong>, choose <strong>Create Namespace</strong> and specify <code>idp-mgmt-config</code>. If there is already a namespace <code>idp-mgmt-config</code> or you prefer another namespace, choose a different namespace.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Channel: The channel that you select corresponds to the release that you are installing. When you select the channel, it installs the identified release, and establishes that the future errata updates within that release are obtained.</p>
</li>
<li>
<p>Approval strategy: The approval strategy identifies the human interaction that is required for applying updates to the channel or release to which you subscribed.</p>
<div class="ulist">
<ul>
<li>
<p>Select <strong>Automatic</strong> to ensure any updates within that release are automatically applied.</p>
</li>
<li>
<p>Select <strong>Manual</strong> to receive a notification when an update is available. If you have concerns about when the updates are applied, this might be best practice for you.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Note:</strong> To upgrade to the next minor release, you must return to the <em>OperatorHub</em> page and select a new channel for the more current release.</p>
</div>
</li>
<li>
<p>Select <strong>Install</strong> to apply your changes and create the operator.</p>
<div class="paragraph">
<p>After the
identity configuration management for Kubernetes is created, the status for the operator is <em>Running</em> on the <em>Installed Operators</em> page.</p>
</div>
</li>
<li>
<p>After installing the operator, create an instance of the <code>IDPConfig</code> resource to install the necessary components that provide the IDP configuration management APIs. Here&#8217;s an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">apiVersion: identityconfig.identitatem.io/v1alpha1
kind: IDPConfig
metadata:
  name: idp-config
  namespace: idp-mgmt-config
spec:</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now use the services provided by the identity configuration management
for Kubernetes.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-from-the-cli">Installing from the OpenShift Container Platform CLI</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a
identity configuration management for Kubernetes namespace where the operator requirements are contained. Run the following command, where <code>namespace</code> is the name for your
identity configuration management for Kubernetes namespace. A value of <code>idp-mgmt-config</code> is recommended. The value for <code>namespace</code> might be referred to as <em>Project</em> in the OpenShift Container Platform environment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc create namespace &lt;namespace&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Switch your project namespace to the one that you created. Replace <code>namespace</code> with the name of the
identity configuration management for Kubernetes namespace that you created in step 1.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc project &lt;namespace&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create a YAML file to configure an <code>OperatorGroup</code> resource. Each namespace can have only one operator group. Replace <code>default</code> with the name of your operator group. Replace <code>namespace</code> with the name of your project namespace. See the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: &lt;default&gt;
spec:
  targetNamespaces:
  - &lt;namespace&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Run the following command to create the <code>OperatorGroup</code> resource. Replace <code>operator-group</code> with the name of the operator group YAML file that you created:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc apply -f &lt;path-to-file&gt;/&lt;operator-group&gt;.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Create a YAML file to configure an OpenShift Container Platform Subscription. Your file should look similar to the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: idp-mgmt-operator-subscription
spec:
  sourceNamespace: openshift-marketplace
  source: redhat-operators
  channel: release-1.0
  installPlanApproval: Automatic
  name: idp-mgmt-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> For installing the
identity configuration management for Kubernetes on infrastructure nodes, the see <a href="./install_connected.adoc#infra-olm-sub-add-config"> Operator Lifecycle Manager Subscription additional configuration</a> section.</p>
</div>
</li>
<li>
<p>Run the following command to create the OpenShift Container Platform Subscription. Replace <code>subscription</code> with the name of the subscription file that you created:</p>
<div class="listingblock">
<div class="content">
<pre>oc apply -f &lt;path-to-file&gt;/&lt;subscription&gt;.yaml</pre>
</div>
</div>
</li>
<li>
<p>Create an instance of the <code>IDPConfig</code> resource to install the necessary components that provide the IDP configuration management APIs. Here&#8217;s an example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">apiVersion: identityconfig.identitatem.io/v1alpha1
kind: IDPConfig
metadata:
  name: idp-config
  namespace: idp-mgmt-config
spec:</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>ServiceAccount</code> with a <code>ClusterRoleBinding</code> automatically gives cluster administrator privileges to
identity configuration management for Kubernetes and to any user credentials with access to the namespace where you install
identity configuration management for Kubernetes.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-on-infra-node">Installing on infrastructure nodes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An OpenShift Container Platform cluster can be configured to contain infrastructure nodes for running approved management components. Running components on infrastructure nodes avoids allocating OpenShift Container Platform subscription quota for the nodes that are running those management components.</p>
</div>
<div class="paragraph">
<p>After adding infrastructure nodes to your OpenShift Container Platform cluster, follow the <a href="./install_connected.adoc#installing-from-the-cli">Installing from the OpenShift Container Platform CLI</a> instructions and add the following configurations to the  Operator Lifecycle Manager Subscription.</p>
</div>
<div class="sect2">
<h3 id="adding-infra-nodes">Add infrastructure nodes to the OpenShift Container Platform cluster</h3>
<div class="paragraph">
<p>Follow the procedures that are described in
<a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.8/html/machine_management/creating-infrastructure-machinesets">Creating infrastructure machine sets</a> in the OpenShift Container Platform documentation. Infrastructure nodes are configured with a Kubernetes <code>taint</code> and <code>label</code> to keep non-management workloads from running on them.</p>
</div>
<div class="paragraph">
<p>To be compatible with the infrastructure node enablement provided by
identity configuration management for Kubernetes, ensure your infrastructure nodes have the following <code>taint</code> and <code>label</code> applied:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">metadata:
  labels:
    node-role.kubernetes.io/infra: ""
spec:
  taints:
  - effect: NoSchedule
    key: node-role.kubernetes.io/infra</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="infra-olm-sub-add-config">Operator Lifecycle Manager Subscription additional configuration</h3>
<div class="paragraph">
<p>Add the following additional configuration before applying the Operator Lifecycle Manager Subscription:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spec:
  config:
    nodeSelector:
      node-role.kubernetes.io/infra: ""
    tolerations:
    - key: node-role.kubernetes.io/infra
      effect: NoSchedule
      operator: Exists</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="install-on-disconnected-networks" class="sect0">Install on disconnected networks</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>You might need to install the identity configuration management for Kubernetes operator on Red Hat OpenShift Container Platform clusters that are not connected to the Internet. The procedure to install on a disconnected environment requires some of the same steps as the connected installation.</p>
</div>
<div class="paragraph">
<p>You must download copies of the packages to access them during the installation, rather than accessing them directly from the network during the installation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Upgrades are not supported from identity configuration management for Kubernetes v0.1.0. If you have v0.1.0 installed, you will need to uninstall it before installing v0.2.0.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#disconnect-prerequisites">Prerequisites</a></p>
</li>
<li>
<p><a href="#confirm-ocp-installation-2">Confirm your OpenShift Container Platform installation</a></p>
</li>
<li>
<p><a href="#installing-on-infra-node">Preparing to install on infrastructure nodes</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="disconnect-prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You must meet the following requirements before you install the identity configuration management for Kubernetes operator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Red Hat OpenShift Container Platform version 4.8.12 or later must be deployed in your environment, and you must be logged in with the command line interface (CLI).</p>
</li>
<li>
<p>You need access to the <a href="https://catalog.redhat.com/software/containers/search?p=1&amp;application_categories_list=Container%20Platform%20%2F%20Management">catalog.redhat.com</a>.</p>
<div class="paragraph">
<p><strong>Note:</strong> For managing bare metal clusters, you must have OpenShift Container Platform version 4.8.12 or later.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.8/html/installing/index">OpenShift Container Platform version 4.8 documentation</a>.</p>
</div>
</li>
<li>
<p>Your Red Hat OpenShift Container Platform CLI must be version 4.8 or later, and configured to run <code>oc</code> commands. See <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.8/html/cli_tools/openshift-cli-oc#cli-getting-started">Getting started with the CLI</a> for information about installing and configuring the Red Hat OpenShift CLI.</p>
</li>
<li>
<p>Your Red Hat OpenShift Container Platform permissions must allow you to create a namespace.</p>
</li>
<li>
<p>You must have a workstation with Internet connection to download the dependencies for the operator.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="confirm-ocp-installation-2">Confirm your OpenShift Container Platform installation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>You must have a supported OpenShift Container Platform version, including the registry and storage services, installed and working in your cluster. For information about OpenShift Container Platform version 4.8, see <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.8/">OpenShift Container Platform Documentation</a>.</p>
</li>
<li>
<p>When and if you are connected, you can ensure that the OpenShift Container Platform cluster is set up correctly. Access the OpenShift Container Platform web console.</p>
<div class="paragraph">
<p>Run the <code>kubectl -n openshift-console get route</code> command to access the OpenShift Container Platform web console.
See the following example output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>openshift-console          console             console-openshift-console.apps.new-coral.purple-chesterfield.com                       console              https   reencrypt/Redirect     None</pre>
</div>
</div>
<div class="paragraph">
<p>The console URL in this example is: <code>https:// console-openshift-console.apps.new-coral.purple-chesterfield.com</code>.
Open the URL in your browser and check the result.</p>
</div>
<div class="paragraph">
<p>If the console URL displays <code>console-openshift-console.router.default.svc.cluster.local</code>, set the value for <code>openshift_master_default_subdomain</code> when you install OpenShift Container Platform.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="../install/plan_capacity.html#sizing-your-cluster">Sizing your cluster</a> to learn about setting up capacity for your operator.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-in-a-disconnected-environment">Installing in a disconnected environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Important:</strong> You need to download the required images to a mirroring registry to install the operators in a disconnected environment. Without the download, you might receive <code>ImagePullBackOff</code> errors during your deployment.</p>
</div>
<div class="paragraph">
<p>Follow these steps to install the identity configuration management for Kubernetes operator in a disconnected environment:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a mirror registry. If you do not already have a mirror registry, create one by completing the procedure in the <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.8/html/installing/installing-mirroring-installation-images">Mirroring images for a disconnected installation</a> topic of the Red Hat OpenShift Container Platform documentation.</p>
<div class="paragraph">
<p>If you already have a mirror registry, you can configure and use your existing one.</p>
</div>
</li>
<li>
<p>Create a YAML file that contains the <code>ImageContentSourcePolicy</code> with the name <code>idp-mgmt-config-policy.yaml</code>. <strong>Note:</strong> If you modify this on a running cluster, it causes a rolling restart of all nodes.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: operator.openshift.io/v1alpha1
kind: ImageContentSourcePolicy
metadata:
  name: identity-config
spec:
  repositoryDigestMirrors:
  - mirrors:
    - mirror.registry.com:5000/identity-config
    source: registry.redhat.io/identity-config</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the ImageContentSourcePolicy file by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre>oc apply -f idp-mgmt-config-policy.yaml</pre>
</div>
</div>
</li>
<li>
<p>Enable the disconnected  Operator Lifecycle Manager Red Hat Operators and Community Operators.</p>
<div class="paragraph">
<p>the identity configuration management for Kubernetes operator is included in the  Operator Lifecycle Manager Red Hat Operator catalog.</p>
</div>
</li>
<li>
<p>Configure the disconnected  Operator Lifecycle Manager for the Red Hat Operator catalog. Follow the steps in the <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.8/html/operators/administrator-tasks#" class="bare">https://access.redhat.com/documentation/en-us/openshift_container_platform/4.8/html/operators/administrator-tasks#</a> Operator Lifecycle Manager-restricted-networks[Using Operator Lifecycle Manager on restricted networks] topic of the Red Hat OpenShift Container Platform documentation.</p>
</li>
<li>
<p>Now that you have the image in the disconnected  Operator Lifecycle Manager, continue to install the identity configuration management for Kubernetes operator for Kubernetes from the  Operator Lifecycle Manager catalog.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See <a href="../install/install_connected.html#installing-while-connected-online">Installing while connected online</a> for the required steps.</p>
</div>
</div>
</div>
<h1 id="getting-started" class="sect0">Getting started</h1>
<div class="openblock partintro">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><a href="#managed-cluster-set-and-placement">Preparing your managed cluster set and placement</a></p>
</li>
<li>
<p><a href="#creating-auth-realm">Creating your AuthRealm</a></p>
</li>
<li>
<p><a href="#github-authentication">GitHub authentication</a></p>
</li>
<li>
<p><a href="#ldap-authentication">LDAP authentication</a></p>
</li>
<li>
<p><a href="#byo-cert">Using a custom certificate</a></p>
</li>
<li>
<p><a href="#command-line-interface">Command line interface</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Identity configuration management for Kubernetes is intended to allow you to quickly and easily configure OAuth authentication across your fleet of OpenShift clusters. Through the creation of an AuthRealm custom resource, you are able to specify one or more identity providers (such as GitHub or LDAP) and a placement rule to indicate to which clusters the identity providers should apply. As more clusters are brought under management, their OAuth configuration will be automatically configured simply by matching the specified placement rule.</p>
</div>
<div class="paragraph">
<p>An identity configuration management operator configuration is composed of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A namespace in which the identity configuration will be defined</p>
</li>
<li>
<p>A managedclusterset custom resource which holds the managed clusters which may be part of the identity configuration.</p>
</li>
<li>
<p>A placement custom resource which defines the matching labels to select the clusters.</p>
</li>
<li>
<p>A managedclustersetbinding custom resource to bind that placement to the managedclusterset.</p>
</li>
<li>
<p>For each identity configuration provider, a secret custom resource containing the client ID and client secret to connect to the identity configuration provider.</p>
</li>
<li>
<p>An authrealm custom resource which defines the identiry configuration providers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will first walk through setting up your managed cluster set and placement, then prepare the configuration for your preferred identity provider(s).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managed-cluster-set-and-placement">Preparing your managed cluster set and placement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to add managed clusters to a managed cluster set, the managed clusters must be under management of the hub cluster.
Follow these instructions if managed clusters need to be brought under management by the hub cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Red Hat Advanced Cluster Management - <a href="https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.4/html/clusters/managing-your-clusters#importing-a-target-managed-cluster-to-the-hub-cluster">Importing a target managed cluster to the hub cluster</a></p>
</li>
<li>
<p>Red Hat multicluster engine operator - <a href="https://stolostron.github.io/mce-docs/quick_start.html#getting-started">Importing a target managed cluster to the hub cluster</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once there are managed clusters, create a managed cluster set and managedclustersetbinding.  Then select the
managed clusters that will be a part of the set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Red Hat Advanced Cluster Management - <a href="https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.4/html/clusters/managing-your-clusters#managedclustersets">creating and managing managedclustersets</a></p>
</li>
<li>
<p>Red Hat multicluster engine operator - <a href="https://stolostron.github.io/mce-docs/quick_start.html#getting-started">creating and managing managedclustersets</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now a placement can be created.  This will be used to determine which managed clusters in the managedclusterset will have the identity configuration applied.  See:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Red Hat Advanced Cluster Management - <a href="https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.4/html/clusters/managing-your-clusters#placement-managed">using managedclustersets with placement</a></p>
</li>
<li>
<p>Red Hat multicluster engine operator - <a href="https://stolostron.github.io/mce-docs/quick_start.html#getting-started">creating and managing managedclustersets</a></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The identity configuration management for Kubernetes Technology Preview does not yet utilize custom role definitions for controlling access to work with AuthRealms. Instead, it relies on the role-based access control implemented by multicluster engine and Advanced Cluster Management around ManagedClusterSets, ManagedClusterSetBindings, and Placements. AuthRealms must exist in a namespace containing a Placement, and the Placement leverages the ManagedClusterSets that are bound to that namespace. Access to namespaces with existing bound ManagedClusterSets and/or existing Placements should be managed accordingly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Before detaching a cluster from the hub, you will need to make sure the managed cluster is no longer managed by identity configuration management. You can remove the cluster from identity configuration management either by removing the cluster from the ManagedClusterSet, or by removing labels from the managed cluster as appropriate to no longer match the Placement. If the cluster is detached without first being unmanaged from identity provider management, you will lose access to the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-auth-realm">Creating your AuthRealm</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The AuthRealm custom resoure specifies a combination of one or more <a href="https://docs.openshift.com/container-platform/4.8/authentication/understanding-identity-provider.html">identity providers</a> and a placement that determines to which managed clusters the identity provider(s) should be applied.</p>
</div>
<div class="paragraph">
<p>An AuthRealm resource example is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: identityconfig.identitatem.io/v1alpha1
kind: AuthRealm
metadata:
  name: identity-config-developers
  namespace: identity-config-authrealm
spec:
  identityProviders:
  - github:
      clientID: 41c30d83fd1b4774f871
      clientSecret:
        name: identitatem-github-client-secret
      organizations:
      - identitatem
    mappingMethod: claim
    name: identitatem-developers
    type: GitHub
  placementRef:
    name: dev-clusters-placement
  routeSubDomain: identitatem-devs
  type: dex</code></pre>
</div>
</div>
<div class="paragraph">
<p>The AuthRealm <code>name</code> becomes an identity provider name on each managed cluster to which the AuthRealm applies, and is therefore the label that will appear on the managed cluster OpenShift login button.</p>
</div>
<div class="paragraph">
<p>The <code>identityProviders</code> list values directly correspond to OpenShift Container Platform&#8217;s <a href="https://docs.openshift.com/container-platform/4.8/authentication/understanding-identity-provider.html">identity provider</a> configuration. Only GitHub and LDAP are supported in this Technology Preview. Take special note of the <a href="https://docs.openshift.com/container-platform/4.8/authentication/understanding-identity-provider.html#identity-provider-parameters_understanding-identity-provider"><code>mappingMethod</code></a> field, which controls how mappings are established between the providers identities and User objects.</p>
</div>
<div class="paragraph">
<p>The <code>placementRef</code> contains the name of the Placement custom resource located in the same namespace as the AuthRealm that will determine to which clusters this AuthRealm will apply.</p>
</div>
<div class="paragraph">
<p>The <code>routeSubDomain</code> is used to form the Issuer URL of the intermediary OpenID connect server that is installed and configured automatically on the hub cluster by identity configuration management in order to achieve fleet-wide identity configuration. The managed clusters' cluster OAuth configurations connect to this OpenID connect server via the Issuer URL, rather than connecting to the desired identity provider directly.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>routeSubDomain</code> must be unique among all AuthRealms on the hub cluster. It must be a max of 54 characters. It must meet the requirements of a DNS subdomain and therefore must also contain only lowercase alphanumeric characters, '-' or '.', and start and end with an alphanumeric character. Once specified, the <code>routeSubDomain</code> must not be modified. If you need to change this value, delete the AuthRealm and start again. These rules will be enforced in a future version of the operator, and failure to comply will result in unexpected results with the technology preview.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>type</code> field must be set to <code>dex</code> for the Technology Preview. The Technology Preview leverages Dex under the covers as described above to achieve fleet-wide identity configuration.</p>
</div>
<div class="paragraph">
<p>The sections below outline more details and specific steps necessary to create your AuthRealm for GitHub or LDAP.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="github-authentication">GitHub authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use GitHub-based authentication, an OAuth application must be defined in GitHub.</p>
</div>
<div class="sect2">
<h3 id="_github_oauth">GitHub OAuth</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The GitHub Oauth app can be created in your personal profile or in a Github organization that you are an administrator for.</p>
<div class="ulist">
<ul>
<li>
<p>To create a GitHub Oauth app in your personal profile: Open a web browser and navigate to <a href="https://github.com" class="bare">https://github.com</a>, go to <em>Settings &gt; Developer Settings &gt; OAuth Apps</em> (The shortcut is <a href="https://github.com/settings/developers" class="bare">https://github.com/settings/developers</a>)</p>
</li>
<li>
<p>To create a GitHub Oauth app in a GitHub organization that you are an administrator for: Open a web browser and navigate to <a href="https://github.com/{organization_name}" class="bare">https://github.com/{organization_name}</a>, go to <em>Settings &gt; Developer Settings &gt; OAuth Apps</em> (The shortcut is <a href="https://github.com/{organization_name}/settings/developers" class="bare">https://github.com/{organization_name}/settings/developers</a>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Add a <strong>New OAuth App</strong>. In the new OAuth app, <strong>Generate a new client secret</strong>. Copy the Client ID and Client Secret values and save them. They will be needed later.</p>
</li>
<li>
<p>Fill in the <strong>Application name</strong> with something to help identify the owner and hub it will be used for.
NOTE: If you have more than one hub, each one will need its own OAuth app.</p>
</li>
<li>
<p>Fill in <strong>Homepage URL</strong>  and <strong>Authorization callback URL</strong> with the OpenShift console URL.
(NOTE: A little bit later we will correct the <strong>Authorization callback URL</strong> value once we have the proper value.)</p>
</li>
<li>
<p>Click <strong>Register Application</strong>
<strong>NOTE:</strong> Leave this web page open so you can quickly correct the <strong>Authorization callback URL</strong> value once you have the proper value.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_authrealm_custom_resource_for_github">AuthRealm custom resource for GitHub</h3>
<div class="paragraph">
<p>With your GitHub OAuth app created and your client id and secret in hand, you are ready to create your AuthRealm custom resource.</p>
</div>
<div class="paragraph">
<p>An example of an AuthRealm custom resource configured for the Github identity provider is provided below. Make note of the <code>identityProviders</code> field and the configuration of the <code>github</code> identity provider under it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: identityconfig.identitatem.io/v1alpha1
kind: AuthRealm
metadata:
  name: identity-config-developers
  namespace: identity-config-authrealm
spec:
  identityProviders:
  - github:
      clientID: 41c30d83fd1b4774f871
      clientSecret:
        name: identitatem-github-client-secret
      organizations:
      - identitatem
    mappingMethod: claim
    name: identitatem-developers
    type: GitHub
  placementRef:
    name: dev-clusters-placement
  routeSubDomain: identitatem-devs
  type: dex</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>identityProviders</code> list contains the configurations for one or more identity providers. The example above contains a single identity provider (GitHub).
An entry under <code>identityProviders</code> has the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> contains the unique name that is used to identify the identity provider.</p>
</li>
<li>
<p><code>type</code> specifies the identity provider type and it is set to GitHub.</p>
</li>
<li>
<p><code>mappingMethod</code> (add, claim or lookup) controls how mappings are established between this providers identities and User objects.</p>
</li>
<li>
<p><code>github</code> contains the GitHub specific configurations:</p>
<div class="ulist">
<ul>
<li>
<p><code>clientID</code> contains the client ID of a registered GitHub OAuth application.</p>
</li>
<li>
<p><code>clientSecret</code> contains a reference to a secret object containing the client secret of a registered GitHub OAuth application.  Example secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc create secret generic &lt;github-oauth-clientID-name&gt; --from-literal=clientSecret=&lt;github-oauth-clientID-secret&gt;</code></pre>
</div>
</div>
</li>
<li>
<p><code>organizations</code> contains a list of organizations to authenticate the user against (authentication against specific teams within GitHub organizations is currently not supported). This field can be left blank to skip authentication against specific GitHub organizations. If organizations are specified in the config then the user must be a member of at least one of the specified orgs.<br>
<strong>Note</strong>: If the GitHub OAuth application is not owned by an organization specified in <code>organizations</code>, an organization owner must grant third-party access to use this option. This can be done in two ways:</p>
<div class="ulist">
<ul>
<li>
<p>by the GitHub organization&#8217;s administrator from the GitHub organization settings,</p>
</li>
<li>
<p>or, during the first GitHub login when the user will be presented with a UI to explicitly request access to the GitHub organization. The request will flow to the GitHub organization&#8217;s administrator for approval and the user will only be able to login after the request for access is approved.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create your AuthRealm, copy the sample yaml above and update as appropriate with your client id and secret, GitHub organization(s) (if desired), and preferred names, namespace, route subdomain, and mapping method. Then, run the following command on your hub cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc create -f &lt;authrealm_file_name&gt;.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>With your AuthRealm created, you are ready to update your GitHub OAuth app&#8217;s authorization callback URL. Leverage the <code>routeSubDomain</code> you specified in your AuthRealm, and run the script below while logged in to your hub cluster to generate the proper value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">export ROUTE_SUBDOMAIN=&lt;your_route_subdomain&gt;
export APPS=$(oc get infrastructure cluster -ojsonpath='{.status.apiServerURL}' | cut -d':' -f2 | sed 's/\/\/api/apps/g')
echo "Authorization callback URL: https://${ROUTE_SUBDOMAIN}.${APPS}/callback"</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, any managed cluster that matches your Placement should be updated with an OAuth configuration that leverages an OpenID identity provider to connect to the proxy server that identity configuration management has stood up under the covers. Allow several minutes for the new login button to appear on your managed cluster.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ldap-authentication">LDAP authentication</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ldap">LDAP</h3>
<div class="paragraph">
<p>The LDAP identity provider configuration allows email/password based authentication backed by a LDAP directory. During authentication, the LDAP directory is searched for an entry that matches the provided user name. If a single unique match is found, a simple bind is attempted using the distinguished name (DN) of the entry plus the provided password.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_ldap">Setting up LDAP:</h3>
<div class="paragraph">
<p>There are multiple options available for setting up an LDAP directory. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OpenLDAP</strong>: an open-source implementation of LDAP. The following article has information on hosting and deploying an OpenLDAP server: <a href="https://medium.com/ibm-garage/how-to-host-and-deploy-an-openldap-sever-in-openshift-affab06a4365" class="bare">https://medium.com/ibm-garage/how-to-host-and-deploy-an-openldap-sever-in-openshift-affab06a4365</a></p>
</li>
<li>
<p><strong>Secure LDAP using Azure Active Directory</strong>: The following tutorial describes the steps for setting up Secure LDAP with Azure Active Directory: <a href="https://docs.microsoft.com/en-us/azure/active-directory-domain-services/tutorial-configure-ldaps" class="bare">https://docs.microsoft.com/en-us/azure/active-directory-domain-services/tutorial-configure-ldaps</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_authrealm_custom_resource_for_ldap">AuthRealm custom resource for LDAP</h3>
<div class="paragraph">
<p>An example of an AuthRealm custom resource configured for the LDAP identity provider is provided below. Make note of the <code>identityProviders</code> field and the configuration of the <code>ldap</code> identity provider under it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: identityconfig.identitatem.io/v1alpha1
kind: AuthRealm
metadata:
  name: authrealm-ldap
  namespace: authrealm-ldap-ns
spec:
  type: dex
  routeSubDomain: identitatem-devs
  placementRef:
    name: authrealm-ldap-placement
  ldapExtraConfigs:
    openldap:
      baseDN: "dc=example,dc=com"
      filter: "(objectClass=person)"
  identityProviders:
    - name: openldap
      type: LDAP
      mappingMethod: add
      ldap:
        url: a438af6d7959d448fb56138b20e2bbba-2094583330.us-east-1.elb.amazonaws.com:636
        insecure: false
        bindDN: cn=Manager,dc=example,dc=com
        ca:
          name: authrealm-ldap-ca
          namespace: authrealm-ldap-ns
        bindPassword:
          name: authrealm-ldap-secret
          namespace: authrealm-ldap-ns
        attributes:
          id:
            - DN
          preferredUsername:
            - mail
          name:
            - cn
          email:
            - mail</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>identityProviders</code> list contains the configurations for one or more identity providers. The example above contains a single identity provider (LDAP).
An entry under <code>identityProviders</code> has the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> contains the unique name that is used to identify the identity provider.</p>
</li>
<li>
<p><code>type</code> specifies the identity provider type and it is set to LDAP.</p>
</li>
<li>
<p><code>mappingMethod</code> (add, claim or lookup) controls how mappings are established between this providers identities and User objects.</p>
</li>
<li>
<p><code>ldapExtraConfigs</code> contains extra server configuration setting for LDAP, the key being the idp.name</p>
<div class="ulist">
<ul>
<li>
<p><code>baseDN</code> contains information to start the LDAP user search from. For example "cn=users,dc=example,dc=com"</p>
</li>
<li>
<p><code>filter</code> contains optional filter to apply when searching the directory. For example "(objectClass=person)"</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>ldap</code> contains the LDAP specific configurations:</p>
<div class="ulist">
<ul>
<li>
<p><code>url</code> contains the LDAP host and optional port of the LDAP server</p>
</li>
<li>
<p><code>bindDN</code> contains an optional DN to bind with during the search phase.</p>
</li>
<li>
<p><code>bindPassword</code> contains an optional reference to a secret by name containing a password to bind with during the search phase.
<strong>Note</strong>: bindDN and bindPassword need to be provided if the LDAP server requires authentication for search.</p>
</li>
<li>
<p><code>ca</code> contains reference to the secret containing a trusted Root CA file - file name and format: "ca.crt"
<strong>Note</strong>: If the server uses self-signed certificates, include files with names "tls.crt" and "tls.key" (representing client certificate and key) in the same secret</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>attributes</code> maps LDAP attributes to identities</p>
<div class="ulist">
<ul>
<li>
<p><code>id</code> is the list of attributes whose values should be used as the user ID. Required. First non-empty attribute is used. At least one attribute is required. If none of the liste attribute have a value, authentication fails. LDAP standard identity attribute is "dn"</p>
</li>
<li>
<p><code>preferredUsername</code> is the list of attributes whose values should be used as the preferred username. LDAP standard login attribute is "uid"</p>
</li>
<li>
<p><code>name</code> is the list of attributes whose values should be used as the display name. Optional. If unspecified, no display name is set for the identity. LDAP standard display name attribute is "cn"</p>
</li>
<li>
<p><code>email</code> is the list of attributes whose values should be used as the email address. Optional. If unspecified, no email is set for the identity</p>
<div class="literalblock">
<div class="content">
<pre>To create your AuthRealm, copy the sample yaml above and update as appropriate with your ldap configuration, preferred names, namespace, route subdomain, and mapping method. Then, run the following command on your hub cluster:</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc create -f &lt;authrealm_file_name&gt;.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, any managed cluster that matches your Placement should be updated with an OAuth configuration that leverages an OpenID identity provider to connect to the proxy server that identity configuration management has stood up under the covers. Allow several minutes for the new login button to appear on your managed cluster.
You will be able to login with the ldap user.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="byo-cert">Using a custom certificate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, identity configuration management stands up an OpenID Connect proxy service that leverages the hub cluster&#8217;s default ingress certificate. You can instead utilize a custom certificate by adding the following two fields to the AuthRealm spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spec:
  certificatesSecretRef:
    name: acme-cert
  host: https://identitatem-devs.acme.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a tls secret containing your custom certificate in the same namespace as your AuthRealm and provide the secret name in <code>certificatesSecretRef.name</code>. For <code>host</code>, specify the full URL of the domain you want created for the OpenID Connect proxy service, including the <code>https://</code> protocol.</p>
</div>
<div class="paragraph">
<p>When creating the tls secret, be sure to specify the <code>tls</code> type.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kubectl create secret tls &lt;acme-cert&gt; --cert=&lt;path/to/cert/file&gt;  --key=&lt;path/to/key/file&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: When you specify a <code>host</code> URL, the <code>routeSubDomain</code> is used only for creating an OpenShift project on your hub cluster to hold resources pertaining to the AuthRealm. It is not reflected in the OpenID Connect proxy service issuer URL.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="command-line-interface">Command line interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AuthRealm configuration can be created through the <a href="https://github.com/stolostron/cm-cli">cm-cli</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">cm create authrealm --values &lt;values.yaml&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Fill the template form</p>
<div class="paragraph">
<p>The template can be retreived by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">cm create authrealm -h</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fill the template and save it as for example my-authrealm.yaml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">authRealm:
  # The name of the authrealm, can be override using the --name parameter
  name:
  # The namespace where the authrealm must be created, can be override using the --namespace
  namespace:
  #The strategy type, only dex is supported, can be override using --type
  type: dex
  # The routeSubDomain to use, can be override using --route-sub-domain
  routeSubDomain:
  # The placement rule to use, if not present then a new one will be created
  # in the authrealm namespace and having for labelSelector the matchLabels below.
  # It can be overridden using --placement
  placement:
  # The matchLabels to use to build the placement if not provided
  # For example:
  # matchLabels:
  #  authdeployment: east
  matchLabels:
  # The managedClusterSet to link the placement to, can be override using --cluster-set
  managedClusterSet:
  # The managedClusterSetBinding, if not present then it will be created to bind
  # the provided placement with the managedClusterSet
  # It can be overridden using --cluster-set-binding
  managedClusterSetBinding:
  # The list of identity providers
  identityProviders:
  # Example for github, this section will be copied into the authrealm CR.
  # Reference: https://github.com/openshift/api/blob/master/config/v1/0000_10_config-operator_01_oauth.crd.yaml#L80
  # The identity provider name
  - name: my-github-idp
    # The mappingMethod could be add, claim or lookup
    mappingMethod: claim
    # The identity provider type, here GitHub
    type: GitHub
    # The github specifics
    github:
      # The client ID of the github app
      clientID:
      # The github app secret, the cm-cli will create a local secret with it
      clientSecret:
      # Lists of GitHub Organizations (optionals)
      organizations:
      - myorg
    #,,,,
  # Example for LDAP, this section will be copied into the authrealm CR.
  # Reference: https://github.com/openshift/api/blob/master/config/v1/0000_10_config-operator_01_oauth.crd.yaml#L215
  # The identity provider name
  - name: my-ldap-idp
    # The mappingMethod could be add, claim or lookup
    mappingMethod: claim
    # The identity provider type, here LDAP
    type: LDAP
    # The ldap specifics
    ldap:
      # The LDAP server url
      url:
      # The bind Domain name
      bindDN:
      # The bind password, the cm-cli will create a local secret with it
      bindPassword:
    #....
  # Extra supported ldap configuration for the dex server
  #
  ldapExtraConfigs:
    # The name of the ldap identity provider
    my-ldap-idp:
      # The base Domain name
      baseDN:
      filter:</code></pre>
</div>
</div>
</li>
<li>
<p>Create the authrealm</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create directly</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">cm create authrealm --values my-authrealm.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Create a file and then apply</p>
<div class="paragraph">
<p>Options --dry-run with --output-file can be used to get the rendered file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">cm create authrealm --values my-authrealm.yaml --dry-run --output-file my-authrealm-yamls.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the my-authrealm-yamls.yaml can be applied using</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc apply -f my-authrealm-yamls.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<h1 id="uninstalling" class="sect0">Uninstalling</h1>
<div class="openblock partintro">
<div class="content">
When you uninstall
identity configuration management for Kubernetes, it might take up to 5 minutes to complete the uninstall process.
The uninstall removes most operator components, excluding components such as custom resource definitions. After this uninstall, you must reinstall the operator before reinstalling the custom resource.
</div>
</div>
<div class="sect1">
<h2 id="prerequisite-deletee-authrealm">Prerequisite: Delete AuthRealm custom resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you uninstall the
identity configuration management for Kubernetes, you must delete all of the AuthRealm custom resources that are managed by the operator.</p>
</div>
<div class="paragraph">
<p>Note: When a cluster&#8217;s authentication is no longer managed by identity configuration management, either because you&#8217;ve deleted all AuthRealms that apply to the cluster or because the cluster no longer matches any Placement rules in your AuthRealms, the original oauth configuration that was in place before identity configuration management began managing the cluster&#8217;s oauth will be restored. This is only true if the managed cluster is still attached to the hub cluster at the point that the managed cluster becomes no longer manged by identity configuration management. Should you need to manually restore the original OAuth, you can find the backup in the ConfigMap named <code>idp-oauth-original</code> in the managed cluster&#8217;s namespace on the hub cluster.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="removing-a-identityconfiguration-instance-by-using-commands">Removing resources by using commands</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already, ensure that your OpenShift Container Platform CLI is configured to run <code>oc</code> commands. See <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.8/html/cli_tools/openshift-cli-oc#cli-getting-started">Getting started with the OpenShift CLI</a> in the OpenShift Container Platform documentation for more information about how to configure the <code>oc</code> commands.</p>
</li>
<li>
<p>Enter the following commands to locate and delete the identity configuration management <code>ClusterServiceVersion</code> in the namespace it is installed in:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal"> oc get csv -A
NAMESPACE            NAME                         DISPLAY                                                           VERSION   REPLACES   PHASE
idp-mgmt-config      idp-mgmt-operator.v1.0.0     identity configuration management for Kubernetes for Kubernetes   1.0.0                Succeeded

 oc delete clusterserviceversion idp-mgmt-operator.v1.0.0 -n idp-mgmt-config
 oc delete sub idp-mgmt-operator -n idp-mgmt-config</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: The CSV version and operator namespace shown here may be different.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deleting-the-components-by-using-the-console">Deleting the components by using the console</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you use the RedHat OpenShift Container Platform console to uninstall, you remove the operator. Complete the following steps to uninstall by using the console:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the OpenShift Container Platform console navigation, select <strong>Operators</strong> &gt; <strong>Installed Operators</strong> &gt; <strong>identity configuration management for Kubernetes</strong>.</p>
</li>
<li>
<p>Remove the <em>identity configuration management for Kubernetes</em> operator by selecting
the <em>Options</em> menu and selecting <strong>Uninstall operator</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="manual-cleanup-steps">Manual cleanup steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once the identity configuration management operator has been removed, some manual cleanup is required to completely remove all artifacts of the Technology Preview.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete a remaining clusterrole</p>
<div class="paragraph">
<p>Run the following command on the hub cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc delete clusterrole dex-operator-dexsso</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshoot-uninstall">Troubleshooting Uninstall</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the identity configuration management custom resource is not being removed, remove any potential remaining artifacts by running the clean-up script.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy the following script into a file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">#!/bin/bash
oc delete crd authrealms.identityconfig.identitatem.io
oc delete crd clusteroauths.identityconfig.identitatem.io
oc delete crd strategies.identityconfig.identitatem.io
oc delete crd dexclients.auth.identitatem.io
oc delete crd dexserver.auth.identitatem.io</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<h1 id="troubleshooting" class="sect0">Troubleshooting</h1>
<div class="sect1">
<h2 id="installer-crash-loop-back-off">The installer pod CrashLoopBackOff</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You launched the IDP installation from the OperatorHub and the installation failed. A reason could be that Red Hat Advanced Cluster Management or Multicluster Engine is not installed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check the installer log</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc get pods -n &lt;idp-installation-namespace&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>note the pod&#8217;s name and then run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc logs -n &lt;idp-installation-namespace&gt; &lt;pod-name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A message similar to the following means the prerequisite are not met.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">2022-01-10T14:17:21.962Z	ERROR	setup	unable to create controller	{"controller": "Installer", "error": "IDP prerequisites are not met: neither Red Hat Advanced Cluster Management or Multicluster Engine installation has been detected, the product Red Hat Advanced Cluster Management is not installed on this cluster\nthe product Multicluster Engine is not installed on this cluster", "errorVerbose": "neither Red Hat Advanced Cluster Management or Multicluster Engine installation has been detected, the product Red Hat Advanced Cluster Management is not installed on this cluster\nthe product Multicluster Engine is not installed on this cluster\nIDP prerequisites are not met"}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="login-button-missing">New login option specified in AuthRealm is not appearing on the managed cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You&#8217;ve created your AuthRealm and updated your managed cluster as appropriate such that it should match the Placement, but the new login option is not appearing on your managed cluster. Follow the steps below to determine the issue.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Wait several minutes. It takes time for the OpenShift authentication pods to restart and reflect the new configuration.</p>
</li>
<li>
<p>If the button does not appear after several minutes, run the following on the managed cluster to confirm the cluster OAuth configuration was propagated correctly from the hub: <code>oc get oauth cluster -oyaml</code> You should see an identity provider with a name matching your AuthRealm name and an issuer URL that reflects your hub cluster URL and routeSubDomain. If you do, continue to the next step. If not, check the following on the hub cluster:</p>
<div class="ulist">
<ul>
<li>
<p>Check the AuthRealm</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc get authrealm &lt;AuthRealm name&gt; -n &lt;AuthRealm namespace&gt; -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>And verify the status.condition.type:Applied has a status of <strong>"True"</strong>.  If the status is false, check the reason and message.
Note: Applied <strong>"True"</strong> just mean the AuthRealm was successfully processed by the controller and subsequent resources are created; it doesn&#8217;t mean the managed cluster authentication system is successfully updated.</p>
</div>
</li>
<li>
<p>Check for a ManifestWork named <strong>idp-oauth</strong> in the managed cluster namespace.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc get manifestworks idp-oauth -n &lt;managed cluster namespace&gt; -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>And verify the status.condition.type:Applied has a status of <strong>"True"</strong>.  If the status is false, wait a minute or two and recheck.  If the ManifestWork does not exist, check the following on the hub cluster:</p>
</div>
</li>
<li>
<p>Check the PlacementDecision in the AuthRealm namespace to be sure the managed cluster was properly selected as part of the Placement and ManagedClusterSet.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc get placementdecision -n &lt;AuthRealm namespace&gt; -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check the status.decision list contains an entry for the managed cluster.  If not, verify the Placement, ManagedClusterSet and ManagedClusterSetBindings are properly configured to include the managed cluster.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>From the OpenShift Container Platform console UI on the managed cluster, navigate to Administration&#8594;Cluster Settings&#8594;ClusterOperators. Check the Status of the <code>authentication</code> operator, and if it is not showing green Available, check the Message for an indication of the error.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/authentication_operator_error.png" alt="authentication operator error message indicates certificate error">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="openshift-auth-error">OpenShift authentication is failing with "An authentication error has occurred"</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The new login option is showing up on your managed cluster, but when you try to complete the authentication flow, it ends with an error from OpenShift that says "An authentication error has occurred". Follow the steps below to determine the issue.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check the logs of the authentication operator by running the following on the managed cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc get pods -n openshift-authentication
oc logs &lt;pod_name&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>If no errors are found, you may need to enable debug mode in the authentication operator:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc edit authentication.operator.openshift.io
  ...
  spec:
    logLevel: Debug  &lt;-- change from Normal to Debug
  managementState: Managed</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the openshift-authentication pods to restart and then check the logs again:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">watch oc get pods -n openshift-authentication
oc logs &lt;pod_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Collisions with existing users and identities on the managed cluster can cause the "An authentication error has occurred" message. Consider whether your selected <a href="https://docs.openshift.com/container-platform/4.8/authentication/understanding-identity-provider.html#identity-provider-parameters_understanding-identity-provider">mapping method</a> in your AuthRealm is right for your situation. Also remember that when you delete a user from a managed cluster, you will also need to delete the identity for that user in order for that user to be created correctly again on future login attempts with a new identity provider:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc get identity
oc delete &lt;identity_name&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="application-not-available">OpenShift authentication is failing with "Application is not available"</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Reaching the "Application is not available" 503 error page after clicking on the OpenShift login button can be an indication of a number of problems. Following are troubleshooting steps you can try.</p>
</div>
<div class="sect2">
<h3 id="github-callback-url">Check your GitHub OAuth app callback URL</h3>
<div class="paragraph">
<p>If you are using GitHub as your identity provider, and are able to successfully authenticate to GitHub, but your OpenShift login then ends with an "Application is not available" message, it is likely that you have an incorrect callback URL specified in your GitHub OAuth application. Review the callback URL in the browser address bar and confirm that it is your route subdomain specified in your AuthRealm (or the <code>host</code> if you are using a custom certificate).</p>
</div>
</div>
<div class="sect2">
<h3 id="troubleshoot-dex-server">Check if the OpenID Connect proxy server is running correctly</h3>
<div class="paragraph">
<p>The OpenID Connect proxy server runs in the namespace <code>idp-mgmt-&lt;AuthRealm.routeSubDomain&gt;</code>. A DexServer custom resource is used by identity configuration management to configure and track this proxy server. From the <code>idp-mgmt-&lt;AuthRealm.routeSubDomain&gt;</code> OpenShift project on your hub cluster, run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc get dexserver dex-server -ojson | jq -r '.status.conditions'
[
  {
    "lastTransitionTime": "2021-11-04T20:30:35Z",
    "message": "DexServer is applied",
    "reason": "Applied",
    "status": "True",
    "type": "Applied"
  },
  {
    "lastTransitionTime": "2021-11-05T12:03:19Z",
    "message": "DexServer deployment is available",
    "reason": "Available",
    "status": "True",
    "type": "Available"
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Confirm no issues are reported. The type "Applied" indicates that the DexServer custom resource was successfully processed by the controller, and all related resources have been synchronized. The type "Available" reflects the status of the Dex server deploment pods.</p>
</div>
<div class="paragraph">
<p>Assuming your DexServer deployment is healthy, next check the ingress. Again from the <code>idp-mgmt-&lt;AuthRealm.routeSubDomain&gt;</code> OpenShift project on your hub cluster, run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc get ingress dex-server
NAME         CLASS    HOSTS                                     ADDRESS                              PORTS     AGE
dex-server   &lt;none&gt;   yourRouteSubDomain.apps.clusterurl.com    router-default.apps.clusterurl.com   80, 443   17h</code></pre>
</div>
</div>
<div class="paragraph">
<p>An empty ADDRESS column is an indication that your ingress has a problem. One possible issue if you are using a custom certificate is that your certificate secret was not set up correctly in the <code>idp-mgmt-&lt;AuthRealm.routeSubDomain</code> namespace. Run <code>oc get secrets</code> and confirm you see an entry with the name you specified in <code>AuthRealm.certificatesSecretRef.name</code> and that it is of type <code>kubernetes.io/tls</code>.</p>
</div>
<div class="paragraph">
<p>If the ingress is not found, an error message should be present in the DexServer custom resource status.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="invalid-client-id">OpenShift authentication fails with "Bad Request" "Invalid client_id"</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If after you press the OpenShift login button, you see a page displaying "Bad Request" and "Invalid client_id", there is an issue with the configuration for this managed cluster on the hub cluster.</p>
</div>
<div class="paragraph">
<p>On the hub cluster, look for the dex client that should have been created under the covers for this managed cluster. Run the following on the hub cluster, substituting your value for routeSubDomain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc get dexclients -n idp-mgmt-&lt;routeSubDomain&gt;
NAME                                   AGE
&lt;managed_cluster&gt;-&lt;authrealm&gt;          7m18s</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see an entry for your managed cluster. If so, check the status to confirm the DexClient custom resource was successfully applied and an oauth2client was created on the Dex server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc get dexclient  &lt;managed_cluster&gt;-&lt;authrealm&gt; -n idp-mgmt-&lt;routeSubDomain&gt; -ojson | jq -r '.status.conditions'
[
  {
    "lastTransitionTime": "2021-11-11T14:54:48Z",
    "message": "Dex client is created",
    "reason": "Created",
    "status": "True",
    "type": "Applied"
  },
  {
    "lastTransitionTime": "2021-11-11T14:54:48Z",
    "message": "oauth2client is created",
    "reason": "Created",
    "status": "True",
    "type": "OAuth2ClientCreated"
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see a status of "True" for both conditions. If not, review the errors. The type "Applied" indicates whether the controller has successfully processed the DexClient custom resource. The type "OAuth2ClientCreated" indicates whether an oauth2client was created on the Dex server for the managed cluster.</p>
</div>
<div class="paragraph">
<p>If you do not see a dex client for your managed cluster, check the operator logs for errors by running the following on the hub cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc logs -l control-plane=controller-manager -n idp-mgmt-config</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="github-failures">Github login failure</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_user_is_not_a_member_of_the_github_organization_specified_in_the_authrealm">User is not a member of the GitHub organization specified in the AuthRealm</h3>
<div class="paragraph">
<p>If the AuthRealm custom resource specifies one or more values in the <code>github.organizations</code> field, the user attempting login to the cluster via GitHub will be authenticated against the specified organization(s). If the user is not a member of at least one of the organizations specified in the AuthRealm, they will not be able to login. The error will appear as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/github_org_error.png" alt="GitHub authentication error - user not in required org">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Check that the user attempting login is a member of at least one of the GitHub organizations specified in the AuthRealm.</p>
</li>
<li>
<p>If the GitHub OAuth application is not owned by an organization specified in <code>github.organizations</code>, an organization owner must grant third-party access to use this option.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ldap-failures">LDAP related issues</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_issues_with_setting_up_the_openid_connect_proxy_server_correctly_with_the_ldap_connector">Issues with setting up the OpenID Connect proxy server correctly with the LDAP connector</h3>
<div class="paragraph">
<p>If you do not see the new login option even after several minutes, it is possible that the OpenID Connect proxy server is not deployed correctly as it is unable to set up the LDAP connector based on the information provided in the AuthRealm CR. For instance, not specifying <code>ldapExtraConfigs.&lt;idp-name&gt;.baseDN</code> in the AuthRealm CR or missing to create the secret containing the <code>bindPassword</code> can prevent the OpenID Connect proxy server from being deployed correctly.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Refer to the <a href="#troubleshoot-dex-server">step above</a> to view the status information in the DexServer custom resource.</p>
</li>
<li>
<p>Check the logs of the dex server pod by running the following on the hub cluster, substituting your value for <code>routeSubDomain</code>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc get pods -n idp-mgmt-&lt;routeSubDomain&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fetch logs from the pod retrieved in the step above for more information on the error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc logs &lt;pod_name&gt; -n idp-mgmt-&lt;routeSubDomain&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/log_missing_usersearch_basedn.png" alt="Missing baseDN for LDAP user search preventing dex server from being set up correctly">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldap_login_failures">LDAP login failures</h3>
<div class="paragraph">
<p>The new login option is showing up on your managed cluster, but when you try to complete the authentication flow via the <a href="#ldap-login-ui">LDAP login UI</a>, it ends with an error.</p>
</div>
<div id="ldap-login-ui" class="imageblock">
<div class="content">
<img src="./images/ldap_login.png" alt="LDAP login page">
</div>
</div>
<div class="sect3">
<h4 id="_examples_of_errors_that_could_occur_during_this_flow">Examples of errors that could occur during this flow:</h4>
<div class="ulist">
<ul>
<li>
<p>Incorrect bind credentials used to authenticate with the LDAP server</p>
<div class="ulist">
<ul>
<li>
<p>Check that the correct bindDN and bindPassword was provided for the LDAP identity provider in the AuthRealm CR.</p>
<div class="imageblock">
<div class="content">
<img src="./images/invalid_bind_credentials.png" alt="Error - Invalid bind credentials">
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Incorrect certificate for the LDAP server</p>
<div class="ulist">
<ul>
<li>
<p>Check that the correct certificate was provided in the secret that is referenced in the <code>ca</code> field  for the ldap identity provider in the AuthRealm CR.</p>
<div class="imageblock">
<div class="content">
<img src="./images/ldap_ca_error.png" alt="Error - Incorrect certificate for LDAP server">
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>